apiVersion: 1

policies:
  - orgId: 1
    receiver: web.hook
    group_by: ['alertname', 'cluster', 'service']
    group_wait: 10s
    group_interval: 10s
    repeat_interval: 1h
    routes:
      - receiver: critical-alerts
        matchers:
          - severity = critical
        group_wait: 0s
        group_interval: 5m
        repeat_interval: 12h
      - receiver: warning-alerts
        matchers:
          - severity = warning
        group_wait: 10s
        group_interval: 10m
        repeat_interval: 24h

contactPoints:
  - orgId: 1
    name: web.hook
    receivers:
      - uid: webhook-uid
        type: webhook
        settings:
          url: http://localhost:3001/webhook
          httpMethod: POST
          title: APM Alert
          text: |
            {{ range .Alerts }}
            Alert: {{ .Annotations.summary }}
            Description: {{ .Annotations.description }}
            Status: {{ .Status }}
            {{ end }}

  - orgId: 1
    name: critical-alerts
    receivers:
      - uid: critical-webhook-uid
        type: webhook
        settings:
          url: http://localhost:3001/critical-webhook
          httpMethod: POST
          title: üö® CRITICAL APM Alert
          text: |
            üö® CRITICAL ALERT üö®
            {{ range .Alerts }}
            Alert: {{ .Annotations.summary }}
            Description: {{ .Annotations.description }}
            Service: {{ .Labels.service }}
            Severity: {{ .Labels.severity }}
            {{ end }}

  - orgId: 1
    name: warning-alerts
    receivers:
      - uid: warning-webhook-uid
        type: webhook
        settings:
          url: http://localhost:3001/warning-webhook
          httpMethod: POST
          title: ‚ö†Ô∏è APM Warning
          text: |
            ‚ö†Ô∏è WARNING ‚ö†Ô∏è
            {{ range .Alerts }}
            Alert: {{ .Annotations.summary }}
            Description: {{ .Annotations.description }}
            Service: {{ .Labels.service }}
            {{ end }}
